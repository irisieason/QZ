#!/usr/bin/env node

/**
 * Generate CSS custom properties from TypeScript design tokens
 * This script reads src/tokens/colors.ts and generates src/tokens/tokens.css
 */

const fs = require('fs');
const path = require('path');

const tokensPath = path.join(__dirname, '../src/tokens/colors.ts');
const outputPath = path.join(__dirname, '../src/tokens/tokens.css');

// Read the colors.ts file
const content = fs.readFileSync(tokensPath, 'utf-8');

// Extract the colors object
const colorsMatch = content.match(/export const colors = \{([\s\S]*?)\} as const;/);
if (!colorsMatch) {
  console.error('Could not find colors object in colors.ts');
  process.exit(1);
}

const colorsContent = colorsMatch[1];

// Parse color entries
const colorEntries = [];
const lines = colorsContent.split('\n');
for (const line of lines) {
  const match = line.match(/['"]([^'"]+)['"]\s*:\s*['"]([^'"]+)['"]/);
  if (match) {
    const [, name, value] = match;
    colorEntries.push({ name, value });
  }
}

// Extract theme info from comments
const themeMatch = content.match(/Theme:\s*([^\n]+)/);
const modeMatch = content.match(/mode:\s*([^\)]+)\)/);
const theme = themeMatch ? themeMatch[1].trim() : 'Classic Dark';
const mode = modeMatch ? modeMatch[1].trim() : '33940:4';

// Generate CSS
const cssHeader = `/*
 * SPDX-FileCopyrightText: 2025 Siemens AG
 *
 * SPDX-License-Identifier: MIT
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

/*
 * NOTE: This file is automatically generated from Figma Theme Variables.
 * Theme: ${theme} (mode: ${mode})
 * Do NOT edit this file directly â€” changes will be overwritten.
 */

:root {`;

const cssVariables = colorEntries.map(({ name, value }) => {
  return `  --${name}: ${value};`;
}).join('\n');

const cssFooter = '\n}';

const cssContent = cssHeader + '\n' + cssVariables + cssFooter + '\n';

// Write CSS file
fs.writeFileSync(outputPath, cssContent, 'utf-8');

console.log(`âœ… Generated ${colorEntries.length} CSS custom properties`);
console.log(`ğŸ“ Output: ${outputPath}`);
